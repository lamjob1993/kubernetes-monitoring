# Кластер K8s на примере развернутых в нём Java приложений

## **Внутренняя структура кредитного конвейера Java развернутого в кластере K8s (реальный пример для легенды)**

### **Описание системы**

1. **Бэкенд на Java**  
   - Система построена на языке программирования Java, где основная логика реализована в виде микросервисов (адаптеров).  
   - Всего развернуто 30 адаптеров, каждый из которых представляет собой отдельный `jar`-файл, упакованный в контейнер (pod). Эти адаптеры взаимодействуют друг с другом через API.  

2. **Архитектура Kubernetes**  
   - Адаптеры развернуты в Kubernetes на двух нодах:  
     - **Нода 1**: мастер-кластер (основная группа серверов) с подами внутри.  
     - **Нода 2**: резервный кластер, идентичный первой ноде для обеспечения отказоустойчивости.  
   - Каждый адаптер работает в рамках подов — минимальных абстракций Kubernetes над контейнерами. На один адаптер приходится 2-3 пода для повышения надежности и масштабируемости .  

3. **Типы адаптеров**  
   - Адаптеры выполняют различные задачи в рамках кредитного конвейера:  
     - **Калькулятор-адаптер**: рассчитывает параметры кредита.  
     - **Документ-адаптер**: предоставляет подписанные банком документы для клиента.  
     - **Бизнесовые адаптеры**: решают бизнес-задачи.
     - **И прочие 30 адаптеров**: решают другие задачи.  

4. **API-взаимодействие**  
   - Адаптеры взаимодействуют между собой через API-запросы. Например:  
     - Если клиент зависает на этапе расчета кредита, это может быть связано с проблемами в работе калькулятор-адаптера или базы данных PostgreSQL.  
     - Если клиент не может скачать документы, это указывает на проблемы с документ-адаптером.  
   - "Зависание клиента" означает, что пользователь не может завершить действие на сайте (например, расчет кредита или скачивание документов) из-за сбоя в работе одного из адаптеров .  

5. **Мониторинг системы**  
   - Для мониторинга Kubernetes используются следующие инструменты:  
     - **cAdvisor**: собирает метрики с контейнеров (например, использование CPU и памяти).  
     - **kube-state-metrics**: предоставляет метрики состояния объектов Kubernetes (Pods, Deployments, Nodes).  
     - **Prometheus**: забирает метрики от cAdvisor и kube-state-metrics.  
     - **Grafana**: визуализирует данные на дашборде.  
   - Дашборд Kubernetes можно скачать в формате JSON с официального сайта Grafana Labs и настроить под свои нужды .  

6. **Кредитный конвейер**  
   - Кредитный конвейер — это большое Java-приложение, которое объединяет все адаптеры в единую систему.  
   - Каждый адаптер выполняет свою часть работы, а их взаимодействие обеспечивает выполнение бизнес-процессов, таких как оформление кредита или выдача документов .  

---

### **Как работала система?**

1. **Клиент начинает оформление кредита**  
   - Клиент заходит на сайт банка и заполняет форму для расчета кредита.  
   - Сайт отправляет API-запрос калькулятор-адаптеру, который выполняет расчет на основе данных из базы данных PostgreSQL.  

2. **Проблемы с адаптерами**  
   - Если калькулятор-адаптер зависает (например, из-за недоступности базы данных), клиент не может завершить расчет кредита.  
   - Аналогично, если документ-адаптер не отвечает, клиент не может скачать подписанные документы.  

3. **Мониторинг и устранение проблем**  
   - Через Grafana можно отслеживать состояние подов, контейнеров и других объектов Kubernetes.  
   - Если адаптер перестает работать, можно проверить метрики в Grafana, найти проблемный под и перезапустить его через Kubernetes.  

---

Система представляет собой слаженный механизм, где:  
- **Java-адаптеры** выполняют конкретные задачи в рамках кредитного конвейера.  
- **Kubernetes** управляет развертыванием и жизненным циклом адаптеров.  
- **Мониторинг** помогает быстро находить и устранять проблемы в работе системы.  
